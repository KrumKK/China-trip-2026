<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#DC2626">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ‡¨ğŸ‡³</text></svg>">
    <link rel="apple-touch-icon" href="icon-192.png">
    <title>China Trip 2026 ğŸ‡¨ğŸ‡³</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        :root {
            --china-red: #DC2626;
            --china-gold: #F59E0B;
            --china-dark: #1F2937;
            --celeste: #7DD3FC;
            --verde-claro: #86EFAC;
            --beijing: #22C55E;
            --xian: #F97316;
            --zhangjiajie: #3B82F6;
            --shanghai: #EAB308;
        }
        
        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #1F2937 0%, #111827 100%);
            min-height: 100vh;
            min-height: 100dvh;
            color: #F3F4F6;
            padding-top: 70px;
        }
        
        /* Header */
        .header {
            background: var(--celeste);
            padding: 20px;
            text-align: center;
            position: sticky;
            top: 70px;
            z-index: 100;
            transition: transform 0.3s ease;
            transform: translateY(0);
        }
        
        .header.hidden {
            transform: translateY(-100%);
        }
        
        .header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #000000;
        }
        
        .header p {
            font-size: 0.875rem;
            color: #000000;
            opacity: 0.8;
            margin-top: 4px;
        }
        
        /* Timezone widget - hora Madrid / China y diferencia */
        .timezone-bar {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 16px;
            margin-top: 12px;
            padding: 10px 16px;
            background: rgba(0, 0, 0, 0.12);
            border-radius: 8px;
            font-size: 0.85rem;
            flex-wrap: wrap;
        }
        .timezone-bar span {
            color: #000000;
            font-weight: 500;
        }
        .timezone-bar .tz-label {
            opacity: 0.85;
            font-weight: 600;
        }
        .timezone-bar .tz-time {
            font-variant-numeric: tabular-nums;
        }
        .timezone-bar .tz-diff {
            background: rgba(220, 38, 38, 0.2);
            color: #b91c1c;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        /* Tab Navigation */
        .tab-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(17, 24, 39, 0.95);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-around;
            padding: 8px 4px;
            padding-top: max(8px, env(safe-area-inset-top));
            border-bottom: 1px solid #374151;
            z-index: 1000;
            transition: transform 0.3s ease;
            transform: translateY(0);
        }
        
        .tab-bar.hidden {
            transform: translateY(-100%);
        }
        
        .tab-btn {
            background: rgba(55, 65, 81, 0.5);
            border: 1px solid rgba(75, 85, 99, 0.5);
            color: #9CA3AF;
            font-size: 0.75rem;
            padding: 10px 16px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
            border-radius: 4px;
            min-width: 60px;
        }
        
        .tab-btn:hover {
            background: rgba(55, 65, 81, 0.7);
            transform: translateY(-2px);
        }
        
        .tab-btn.active {
            color: var(--china-red);
            background: rgba(220, 38, 38, 0.2);
            border-color: var(--china-red);
            font-weight: 600;
        }
        
        .tab-btn span {
            font-size: 1.25rem;
        }
        
        /* Pages */
        .page {
            display: none;
            padding: 16px;
            animation: fadeIn 0.3s ease;
        }
        
        .page.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Cards */
        .card {
            background: rgba(55, 65, 81, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid rgba(75, 85, 99, 0.5);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .card-title {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .card-subtitle {
            font-size: 0.875rem;
            color: #9CA3AF;
        }
        
        /* Countdown */
        .countdown {
            background: var(--verde-claro);
            border-radius: 16px;
            padding: 32px 24px;
            text-align: center;
            margin-bottom: 16px;
        }
        
        .countdown-title {
            font-size: 1rem;
            color: #000000;
            font-weight: 600;
            margin-bottom: 12px;
        }
        
        .countdown-time {
            font-size: 4rem;
            font-weight: 700;
            color: #000000;
            line-height: 1;
        }
        
        .countdown-label {
            font-size: 1.25rem;
            color: #000000;
            font-weight: 600;
            margin-top: 8px;
        }
        
        /* Flight Card */
        .flight-card {
            border-left: 4px solid var(--china-red);
        }
        
        .flight-card .card-title {
            font-size: 1.25rem;
        }
        
        .flight-route {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 12px 0;
        }
        
        .flight-city {
            text-align: center;
        }
        
        .flight-code {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .flight-name {
            font-size: 0.9rem;
            color: #9CA3AF;
        }
        
        .flight-arrow {
            flex: 1;
            text-align: center;
            color: var(--china-gold);
        }
        
        .flight-details {
            display: flex;
            justify-content: space-between;
            font-size: 1rem;
            color: #9CA3AF;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #374151;
        }
        
        /* City Cards */
        .city-card {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .city-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        
        .city-card.beijing { border-left: 4px solid var(--beijing); }
        .city-card.xian { border-left: 4px solid var(--xian); }
        .city-card.zhangjiajie { border-left: 4px solid var(--zhangjiajie); }
        .city-card.shanghai { border-left: 4px solid var(--shanghai); }
        
        .city-header {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .city-emoji {
            font-size: 2rem;
        }
        
        .city-info h3 {
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .city-info p {
            font-size: 0.875rem;
            color: #9CA3AF;
        }
        
        .city-nights {
            background: rgba(255,255,255,0.1);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            margin-left: auto;
        }
        
        /* Hotel Info */
        .hotel-info {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 2px solid rgba(75, 85, 99, 0.6);
            background: rgba(0, 0, 0, 0.2);
            padding: 16px;
            border-radius: 8px;
            margin-left: -16px;
            margin-right: -16px;
            margin-bottom: -16px;
        }
        
        .hotel-name {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            font-weight: 600;
            font-size: 1.1rem;
            color: #F3F4F6;
        }
        
        .hotel-address {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            font-size: 1rem;
            color: #D1D5DB;
            line-height: 1.5;
            margin-bottom: 10px;
        }
        
        .hotel-status {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 4px;
        }
        
        .hotel-status.pending {
            background: rgba(245, 158, 11, 0.3);
            color: var(--china-gold);
            border: 1px solid rgba(245, 158, 11, 0.5);
        }
        
        .hotel-status.confirmed {
            background: rgba(34, 197, 94, 0.3);
            color: #22C55E;
            border: 1px solid rgba(34, 197, 94, 0.5);
        }
        
        .hotel-dates {
            display: flex;
            gap: 16px;
            margin-top: 10px;
            padding: 10px 0;
            border-top: 1px solid rgba(75, 85, 99, 0.5);
            font-size: 0.95rem;
        }
        
        .hotel-check-in, .hotel-check-out {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .hotel-dates strong {
            color: var(--china-gold);
        }
        
        /* Day Cards */
        .day-card {
            margin-bottom: 12px;
        }
        
        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 12px 0;
        }
        
        .day-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .day-number {
            background: var(--china-red);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }
        
        .day-content {
            display: none;
            padding: 12px;
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
            margin-top: 8px;
        }
        
        .day-content.open {
            display: block;
        }
        
        .day-section {
            margin-bottom: 12px;
        }
        
        .day-section-title {
            font-size: 0.75rem;
            color: var(--china-gold);
            text-transform: uppercase;
            margin-bottom: 4px;
        }
        
        .day-section-text {
            font-size: 0.9rem;
        }
        
        /* Checklist */
        .checklist-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
        }
        
        .checklist-item.checked {
            opacity: 0.6;
        }
        
        .checklist-item.checked .checklist-text {
            text-decoration: line-through;
        }
        
        .checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid #6B7280;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .checklist-item.checked .checkbox {
            background: var(--china-red);
            border-color: var(--china-red);
        }
        
        .checkbox-icon {
            display: none;
            color: white;
        }
        
        .checklist-item.checked .checkbox-icon {
            display: block;
        }
        
        /* Progress Bar */
        .progress-container {
            margin-bottom: 16px;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.875rem;
        }
        
        .progress-bar {
            height: 8px;
            background: #374151;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--china-red), var(--china-gold));
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        /* Reservation Cards */
        .reservation-card {
            position: relative;
        }
        
        .reservation-card.mandatory::before {
            content: 'âš ï¸ Obligatorio';
            position: absolute;
            top: -8px;
            right: 12px;
            background: var(--china-red);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
        }
        
        .reservation-dates {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 12px 0;
        }
        
        .reservation-date {
            background: rgba(0,0,0,0.2);
            padding: 8px;
            border-radius: 8px;
            text-align: center;
        }
        
        .reservation-date-label {
            font-size: 0.7rem;
            color: #9CA3AF;
        }
        
        .reservation-date-value {
            font-weight: 600;
            margin-top: 2px;
        }
        
        /* Info Section */
        .info-section {
            margin-bottom: 20px;
        }
        
        .info-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .phrase-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .phrase-chinese {
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .phrase-pinyin {
            font-size: 0.8rem;
            color: var(--china-gold);
        }
        
        .phrase-spanish {
            font-size: 0.875rem;
            color: #9CA3AF;
            text-align: right;
        }
        
        .emergency-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        
        .emergency-card {
            background: rgba(220, 38, 38, 0.2);
            border: 1px solid var(--china-red);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }
        
        .emergency-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--china-red);
        }
        
        .emergency-name {
            font-size: 0.75rem;
            color: #9CA3AF;
        }
        
        .tip-item {
            padding: 8px 12px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 0.9rem;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }
        
        /* QuÃ© ver - resumen por sitio */
        .que-ver-card {
            background: rgba(55, 65, 81, 0.5);
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 12px;
            border-left: 4px solid var(--china-gold);
        }
        
        .que-ver-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .que-ver-emoji {
            font-size: 1.5rem;
        }
        
        .que-ver-title {
            font-weight: 600;
            font-size: 1rem;
        }
        
        .que-ver-city {
            font-size: 0.75rem;
            color: #9CA3AF;
        }
        
        .que-ver-points {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .que-ver-points li {
            font-size: 0.875rem;
            color: #D1D5DB;
            padding: 4px 0 4px 18px;
            position: relative;
        }
        
        .que-ver-points li::before {
            content: 'â€¢';
            position: absolute;
            left: 0;
            color: var(--china-gold);
        }
        
        .day-content .day-que-ver {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(75, 85, 99, 0.5);
        }
        
        .day-content .day-que-ver .que-ver-points {
            margin-top: 6px;
        }
        
        /* Extra sites (del Excel) */
        .extra-site-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .extra-site-info {
            flex: 1;
        }
        
        .extra-site-city {
            font-size: 0.75rem;
            color: #9CA3AF;
        }
        
        .extra-site-delete {
            background: rgba(220, 38, 38, 0.3);
            border: 1px solid var(--china-red);
            color: white;
            border-radius: 6px;
            padding: 6px 12px;
            font-size: 0.8rem;
            cursor: pointer;
            flex-shrink: 0;
        }
        
        .extra-site-delete:hover {
            background: var(--china-red);
        }
        
        /* Converter */
        .converter {
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
            padding: 16px;
        }
        
        .converter-input {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .converter-input input {
            flex: 1;
            background: #374151;
            border: none;
            padding: 12px;
            border-radius: 8px;
            color: white;
            font-size: 1.25rem;
            width: 100%;
        }
        
        .converter-result {
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--china-gold);
        }
        
        /* Category */
        .category {
            margin-bottom: 16px;
        }
        
        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(55, 65, 81, 0.5);
            border-radius: 12px;
            cursor: pointer;
            margin-bottom: 8px;
        }
        
        .category-title {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .category-progress {
            font-size: 0.875rem;
            color: #9CA3AF;
        }
        
        .category-content {
            display: none;
            padding: 0 8px;
        }
        
        .category-content.open {
            display: block;
        }
        
        /* Back Button */
        .back-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: none;
            border: none;
            color: var(--china-gold);
            font-size: 1rem;
            cursor: pointer;
            margin-bottom: 16px;
            padding: 8px 0;
        }
        
        /* Transport Cards */
        .transport-card {
            border-left: 4px solid var(--china-gold);
        }
        
        .transport-card .card-title {
            font-size: 1.25rem;
        }
        
        .transport-card p,
        .transport-card .text-sm {
            font-size: 1rem;
        }
        
        .transport-type {
            display: inline-block;
            padding: 2px 8px;
            background: rgba(245, 158, 11, 0.2);
            color: var(--china-gold);
            border-radius: 4px;
            font-size: 0.75rem;
            margin-bottom: 8px;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .stat-card {
            background: rgba(55, 65, 81, 0.5);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--china-gold);
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: #9CA3AF;
            margin-top: 4px;
        }
        
        /* Section Title */
        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 20px 0 12px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Utilities */
        .text-red { color: var(--china-red); }
        .text-gold { color: var(--china-gold); }
        .text-green { color: #22C55E; }
        .text-gray { color: #9CA3AF; }
        .mt-2 { margin-top: 8px; }
        .mb-2 { margin-bottom: 8px; }
        .text-sm { font-size: 0.875rem; }
        .text-center { text-align: center; }
        .font-bold { font-weight: 700; }
        
        /* Hidden on desktop message */
        @media (min-width: 768px) {
            body {
                max-width: 480px;
                margin: 0 auto;
            }
        }
    </style>
</head>
<body>
    <!-- Tab Bar -->
    <nav class="tab-bar">
        <button class="tab-btn active" onclick="showPage('vuelos', this)">
            <span>âœˆï¸</span>
            Vuelos
        </button>
        <button class="tab-btn" onclick="showPage('ruta', this)">
            <span>ğŸ“</span>
            Ruta
        </button>
        <button class="tab-btn" onclick="showPage('ciudades', this)">
            <span>ğŸ™ï¸</span>
            Ciudades
        </button>
        <button class="tab-btn" onclick="showPage('reservas', this)">
            <span>âš ï¸</span>
            Reservas
        </button>
        <button class="tab-btn" onclick="showPage('check', this)">
            <span>âœ…</span>
            Check
        </button>
        <button class="tab-btn" onclick="showPage('info', this)">
            <span>â„¹ï¸</span>
            Info
        </button>
    </nav>

    <!-- Header -->
    <header class="header">
        <h1>China Trip 2026</h1>
        <p>1-21 Abril â€¢ 2 adultos + 1 niÃ±o</p>
        <div class="timezone-bar">
            <span><span class="tz-label">ğŸ‡ªğŸ‡¸ Madrid</span> <span class="tz-time" id="tz-madrid">--:--:--</span></span>
            <span><span class="tz-label">ğŸ‡¨ğŸ‡³ China</span> <span class="tz-time" id="tz-china">--:--:--</span> <small>(Beijing, Xi'an, Zhangjiajie, Shanghai)</small></span>
            <span class="tz-diff" id="tz-diff">--</span>
        </div>
    </header>

    <!-- Pages -->
    
    <!-- VUELOS PAGE -->
    <div id="page-vuelos" class="page active">
        <div class="countdown" id="countdown">
            <div class="countdown-title">â±ï¸ Cuenta atrÃ¡s para el viaje</div>
            <div class="countdown-time" id="countdown-time">--</div>
            <div class="countdown-label" id="countdown-label">dÃ­as</div>
        </div>

        <h2 class="section-title">âœˆï¸ Vuelos Internacionales</h2>
        
        <div class="card flight-card">
            <div class="card-header">
                <span class="card-title">ğŸ›« Vuelo de Ida</span>
                <span class="text-sm text-gray">1 Abril 2026</span>
            </div>
            <div class="flight-route">
                <div class="flight-city">
                    <div class="flight-code">BCN</div>
                    <div class="flight-name">Barcelona</div>
                </div>
                <div class="flight-arrow">âœˆï¸ â€•â€•â€•â†’</div>
                <div class="flight-city">
                    <div class="flight-code">PEK</div>
                    <div class="flight-name">PekÃ­n</div>
                </div>
            </div>
            <div class="flight-details">
                <span>ğŸ• 12:30 â†’ 05:45+1</span>
                <span>â±ï¸ ~11h</span>
                <span>Air China</span>
            </div>
        </div>

        <div class="card flight-card">
            <div class="card-header">
                <span class="card-title">ğŸ›¬ Vuelo de Vuelta</span>
                <span class="text-sm text-gray">21 Abril 2026</span>
            </div>
            <div class="flight-route">
                <div class="flight-city">
                    <div class="flight-code">PVG</div>
                    <div class="flight-name">ShanghÃ¡i</div>
                </div>
                <div class="flight-arrow">âœˆï¸ â€•â€•â€•â†’</div>
                <div class="flight-city">
                    <div class="flight-code">BCN</div>
                    <div class="flight-name">Barcelona</div>
                </div>
            </div>
            <div class="flight-details">
                <span>ğŸ• 00:40 â†’ 07:55</span>
                <span>â±ï¸ ~13h</span>
                <span>Air China</span>
            </div>
        </div>

        <h2 class="section-title">ğŸš„ Transporte Interno</h2>
        
        <div class="card flight-card">
            <div class="card-header">
                <span class="card-title">ğŸš„ Tren Alta Velocidad</span>
                <span class="text-sm text-gray">8 Abril 2026</span>
            </div>
            <div class="flight-route">
                <div class="flight-city">
                    <div class="flight-code">BJS</div>
                    <div class="flight-name">Beijing</div>
                </div>
                <div class="flight-arrow">ğŸš„ â€•â€•â€•â†’</div>
                <div class="flight-city">
                    <div class="flight-code">XIY</div>
                    <div class="flight-name">Xi'an</div>
                </div>
            </div>
            <div class="flight-details">
                <span>ğŸ“… 8 Abril</span>
                <span>â±ï¸ ~4h30</span>
                <span>Tren G / 55-80â‚¬</span>
            </div>
            <p class="text-sm text-green mt-2">ğŸ’¡ NiÃ±o &lt;1.2m GRATIS</p>
        </div>

        <div class="card flight-card">
            <div class="card-header">
                <span class="card-title">ğŸ›« Vuelo</span>
                <span class="text-sm text-gray">11 Abril 2026</span>
            </div>
            <div class="flight-route">
                <div class="flight-city">
                    <div class="flight-code">XIY</div>
                    <div class="flight-name">Xi'an</div>
                </div>
                <div class="flight-arrow">âœˆï¸ â€•â€•â€•â†’</div>
                <div class="flight-city">
                    <div class="flight-code">DYG</div>
                    <div class="flight-name">Zhangjiajie</div>
                </div>
            </div>
            <div class="flight-details">
                <span>ğŸ• 14:35 â†’ 16:05</span>
                <span>â±ï¸ ~1h30</span>
                <span>3U3257 Â· Sichuan Airlines</span>
            </div>
        </div>

        <div class="card flight-card">
            <div class="card-header">
                <span class="card-title">ğŸ›« Vuelo</span>
                <span class="text-sm text-gray">14 Abril 2026</span>
            </div>
            <div class="flight-route">
                <div class="flight-city">
                    <div class="flight-code">DYG</div>
                    <div class="flight-name">Zhangjiajie</div>
                </div>
                <div class="flight-arrow">âœˆï¸ â€•â€•â€•â†’</div>
                <div class="flight-city">
                    <div class="flight-code">PVG</div>
                    <div class="flight-name">Shanghai</div>
                </div>
            </div>
            <div class="flight-details">
                <span>ğŸ• 14:40 â†’ 16:50</span>
                <span>â±ï¸ ~2h10</span>
                <span>H01136 Â· Juneyao Airlines</span>
            </div>
        </div>
    </div>

    <!-- RUTA PAGE -->
    <div id="page-ruta" class="page">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">20</div>
                <div class="stat-label">DÃ­as totales</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">4</div>
                <div class="stat-label">Ciudades</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">18</div>
                <div class="stat-label">Noches</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">2</div>
                <div class="stat-label">DÃ­as Disney</div>
            </div>
        </div>

        <h2 class="section-title">ğŸ“ Ruta del Viaje</h2>
        
        <div class="card city-card beijing" onclick="showCity('beijing')">
            <div class="city-header">
                <span class="city-emoji">ğŸ¯</span>
                <div class="city-info">
                    <h3>Beijing</h3>
                    <p>2-7 Abril</p>
                </div>
                <span class="city-nights">6 noches</span>
            </div>
            <div class="hotel-info">
                <div class="hotel-dates">
                    <span class="hotel-check-in"><strong>ğŸ“… Entrada:</strong> 2 Abril</span>
                    <span class="hotel-check-out"><strong>ğŸ“¤ Salida:</strong> 8 Abril</span>
                </div>
                <div class="hotel-name">
                    <span>ğŸ¨</span>
                    <span><strong>Hotel:</strong> Jingli Hotel (Beijing Heshenghui Dajiaoting Subway Station Branch)</span>
                </div>
                <div class="hotel-address">
                    <span>ğŸ“</span>
                    <span><strong>DirecciÃ³n:</strong> åŒ—äº¬å¸‚æœé˜³åŒºä¸œå››ç¯ä¸­è·¯92å·45å·æ¥¼ï¼ˆå¤§éƒŠäº­æ¡¥ä¸œå—è§’ï¼‰</span>
                </div>
                <span class="hotel-status confirmed">âœ… Confirmado</span>
            </div>
        </div>

        <div class="card city-card xian" onclick="showCity('xian')">
            <div class="city-header">
                <span class="city-emoji">âš”ï¸</span>
                <div class="city-info">
                    <h3>Xi'an</h3>
                    <p>8-11 Abril</p>
                </div>
                <span class="city-nights">3 noches</span>
            </div>
            <div class="hotel-info">
                <div class="hotel-dates">
                    <span class="hotel-check-in"><strong>ğŸ“… Entrada:</strong> 8 Abril</span>
                    <span class="hotel-check-out"><strong>ğŸ“¤ Salida:</strong> 11 Abril</span>
                </div>
                <div class="hotel-name">
                    <span>ğŸ¨</span>
                    <span><strong>Hotel:</strong> Yimu Yishu Garden Homestay (Xi'an Big Wild Goose Pagoda Datang Everbright City Branch)</span>
                </div>
                <div class="hotel-address">
                    <span>ğŸ“</span>
                    <span><strong>DirecciÃ³n:</strong> é™•è¥¿çœè¥¿å®‰å¸‚é›å¡”åŒºèŠ™è“‰ä¸œè·¯99å·ä¸­æµ·é“‚æ‚¦å®«501æ ‹Cå•å…ƒ1æ¥¼</span>
                </div>
                <span class="hotel-status confirmed">âœ… Confirmado</span>
            </div>
        </div>

        <div class="card city-card zhangjiajie" onclick="showCity('zhangjiajie')">
            <div class="city-header">
                <span class="city-emoji">ğŸ”ï¸</span>
                <div class="city-info">
                    <h3>Zhangjiajie</h3>
                    <p>11-13 Abril</p>
                </div>
                <span class="city-nights">3 noches</span>
            </div>
            <div class="hotel-info">
                <div class="hotel-dates">
                    <span class="hotel-check-in"><strong>ğŸ“… Entrada:</strong> 11 Abril</span>
                    <span class="hotel-check-out"><strong>ğŸ“¤ Salida:</strong> 14 Abril</span>
                </div>
                <div class="hotel-name">
                    <span>ğŸ¨</span>
                    <span><strong>Hotel:</strong> Pendiente</span>
                </div>
                <div class="hotel-address">
                    <span>ğŸ“</span>
                    <span><strong>DirecciÃ³n:</strong> Pendiente</span>
                </div>
                <span class="hotel-status pending">â³ Pendiente</span>
            </div>
        </div>

        <div class="card city-card shanghai" onclick="showCity('shanghai')">
            <div class="city-header">
                <span class="city-emoji">ğŸ¡</span>
                <div class="city-info">
                    <h3>Shanghai</h3>
                    <p>14-20 Abril</p>
                </div>
                <span class="city-nights">6 noches</span>
            </div>
            <div class="hotel-info">
                <div class="hotel-dates">
                    <span class="hotel-check-in"><strong>ğŸ“… Entrada:</strong> 14 Abril</span>
                    <span class="hotel-check-out"><strong>ğŸ“¤ Salida:</strong> 21 Abril</span>
                </div>
                <div class="hotel-name">
                    <span>ğŸ¨</span>
                    <span><strong>Hotel:</strong> Pendiente</span>
                </div>
                <div class="hotel-address">
                    <span>ğŸ“</span>
                    <span><strong>DirecciÃ³n:</strong> Pendiente</span>
                </div>
                <span class="hotel-status pending">â³ Pendiente</span>
            </div>
        </div>

        <h2 class="section-title">â­ Highlights del viaje</h2>
        <div class="card">
            <div class="tip-item">ğŸ› TobogÃ¡n en la Gran Muralla (Mutianyu)</div>
            <div class="tip-item">ğŸ›— Ascensor Bailong 326m (Zhangjiajie)</div>
            <div class="tip-item">ğŸ° 2 dÃ­as en Shanghai Disneyland</div>
            <div class="tip-item">âš”ï¸ Guerreros de Terracota</div>
            <div class="tip-item">ğŸš„ Tren Maglev 430km/h</div>
            <div class="tip-item">ğŸš² Muralla de Xi'an en bici</div>
        </div>

        <h2 class="section-title">ğŸ“Œ QuÃ© ver en cada sitio</h2>
        <p class="text-sm text-gray mb-2">Resumen de lo mÃ¡s importante en cada punto del itinerario.</p>
        <div id="que-ver-container"></div>

        <h2 class="section-title">ğŸ“‹ Otros sitios (del Excel)</h2>
        <p class="text-sm text-gray mb-2">Puedes borrar los que no quieras visitar.</p>
        <div id="extra-sites-container" class="card"></div>
    </div>

    <!-- CIUDADES PAGE -->
    <div id="page-ciudades" class="page">
        <div id="cities-list">
            <h2 class="section-title">ğŸ™ï¸ Selecciona una ciudad</h2>
            
            <div class="card city-card beijing" onclick="showCity('beijing')">
                <div class="city-header">
                    <span class="city-emoji">ğŸ¯</span>
                    <div class="city-info">
                        <h3>Beijing</h3>
                        <p>Ciudad Prohibida, Gran Muralla, Templo del Cielo</p>
                    </div>
                </div>
            </div>

            <div class="card city-card xian" onclick="showCity('xian')">
                <div class="city-header">
                    <span class="city-emoji">âš”ï¸</span>
                    <div class="city-info">
                        <h3>Xi'an</h3>
                        <p>Guerreros Terracota, Muralla en bici, Barrio MusulmÃ¡n</p>
                    </div>
                </div>
            </div>

            <div class="card city-card zhangjiajie" onclick="showCity('zhangjiajie')">
                <div class="city-header">
                    <span class="city-emoji">ğŸ”ï¸</span>
                    <div class="city-info">
                        <h3>Zhangjiajie</h3>
                        <p>MontaÃ±as Avatar, Ascensor Bailong, Tianmen</p>
                    </div>
                </div>
            </div>

            <div class="card city-card shanghai" onclick="showCity('shanghai')">
                <div class="city-header">
                    <span class="city-emoji">ğŸ¡</span>
                    <div class="city-info">
                        <h3>Shanghai</h3>
                        <p>Disneyland, The Bund, Yu Garden, Maglev</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="city-detail" style="display:none;">
            <button class="back-btn" onclick="hideCityDetail()">â† Volver a ciudades</button>
            <div id="city-detail-content"></div>
        </div>
    </div>

    <!-- RESERVAS PAGE -->
    <div id="page-reservas" class="page">
        <div class="progress-container">
            <div class="progress-header">
                <span>Progreso de reservas</span>
                <span id="reservas-progress-text">0/9</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="reservas-progress-bar" style="width: 0%"></div>
            </div>
        </div>

        <h2 class="section-title">âš ï¸ Reservas Obligatorias</h2>
        <div id="reservas-obligatorias"></div>

        <h2 class="section-title">ğŸ“‹ Otras Reservas</h2>
        <div id="reservas-otras"></div>
    </div>

    <!-- CHECK PAGE -->
    <div id="page-check" class="page">
        <div class="progress-container">
            <div class="progress-header">
                <span>Preparativos completados</span>
                <span id="check-progress-text">0/24</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="check-progress-bar" style="width: 0%"></div>
            </div>
        </div>

        <div id="checklist-container"></div>
    </div>

    <!-- INFO PAGE -->
    <div id="page-info" class="page">
        <div class="info-section">
            <h3 class="info-title">ğŸ—£ï¸ Frases Ãºtiles</h3>
            <div class="phrase-card">
                <div>
                    <div class="phrase-chinese">ä½ å¥½</div>
                    <div class="phrase-pinyin">NÇ hÇo</div>
                </div>
                <div class="phrase-spanish">Hola</div>
            </div>
            <div class="phrase-card">
                <div>
                    <div class="phrase-chinese">è°¢è°¢</div>
                    <div class="phrase-pinyin">XiÃ¨ xiÃ¨</div>
                </div>
                <div class="phrase-spanish">Gracias</div>
            </div>
            <div class="phrase-card">
                <div>
                    <div class="phrase-chinese">å¤šå°‘é’±</div>
                    <div class="phrase-pinyin">DuÅ shÇo qiÃ¡n</div>
                </div>
                <div class="phrase-spanish">Â¿CuÃ¡nto cuesta?</div>
            </div>
            <div class="phrase-card">
                <div>
                    <div class="phrase-chinese">å•æ‰€åœ¨å“ªé‡Œ</div>
                    <div class="phrase-pinyin">CÃ¨ suÇ’ zÃ i nÇ lÇ</div>
                </div>
                <div class="phrase-spanish">Â¿DÃ³nde estÃ¡ el baÃ±o?</div>
            </div>
            <div class="phrase-card">
                <div>
                    <div class="phrase-chinese">æˆ‘ä¸åƒè¾£</div>
                    <div class="phrase-pinyin">WÇ’ bÃ¹ chÄ« lÃ </div>
                </div>
                <div class="phrase-spanish">No como picante</div>
            </div>
            <div class="phrase-card">
                <div>
                    <div class="phrase-chinese">å¤ªè´µäº†</div>
                    <div class="phrase-pinyin">TÃ i guÃ¬ le</div>
                </div>
                <div class="phrase-spanish">Muy caro</div>
            </div>
        </div>

        <div class="info-section">
            <h3 class="info-title">ğŸš¨ Emergencias</h3>
            <div class="emergency-grid">
                <div class="emergency-card">
                    <div class="emergency-number">110</div>
                    <div class="emergency-name">PolicÃ­a</div>
                </div>
                <div class="emergency-card">
                    <div class="emergency-number">120</div>
                    <div class="emergency-name">Ambulancia</div>
                </div>
                <div class="emergency-card">
                    <div class="emergency-number">119</div>
                    <div class="emergency-name">Bomberos</div>
                </div>
            </div>
        </div>

        <div class="info-section">
            <h3 class="info-title">ğŸŒ¡ï¸ Clima en Abril</h3>
            <div class="card">
                <div class="tip-item">ğŸ¯ <strong>Beijing:</strong> 10-22Â°C, posible lluvia</div>
                <div class="tip-item">âš”ï¸ <strong>Xi'an:</strong> 12-24Â°C, soleado</div>
                <div class="tip-item">ğŸ”ï¸ <strong>Zhangjiajie:</strong> 14-22Â°C, hÃºmedo, niebla</div>
                <div class="tip-item">ğŸ¡ <strong>Shanghai:</strong> 14-22Â°C, variable</div>
            </div>
        </div>

        <div class="info-section">
            <h3 class="info-title">ğŸ’¶ Conversor â‚¬â†’Â¥</h3>
            <div class="converter">
                <div class="converter-input">
                    <input type="number" id="eur-input" placeholder="Euros" oninput="convertCurrency()">
                    <span>â‚¬</span>
                </div>
                <div class="converter-result">
                    <span id="cny-result">0</span> Â¥
                </div>
                <p class="text-center text-sm text-gray mt-2">Tipo de cambio: 1â‚¬ â‰ˆ 8.27Â¥ (enero 2025)</p>
            </div>

            <h3 class="info-title">ğŸ’¶ Conversor Â¥â†’â‚¬</h3>
            <div class="converter">
                <div class="converter-input">
                    <input type="number" id="cny-input" placeholder="Yuanes" oninput="convertCurrencyCnyToEur()">
                    <span>Â¥</span>
                </div>
                <div class="converter-result">
                    <span id="eur-result">0</span> â‚¬
                </div>
                <p class="text-center text-sm text-gray mt-2">Tipo de cambio: 1Â¥ â‰ˆ 0.12â‚¬ (enero 2025)</p>
            </div>
        </div>

        <div class="info-section">
            <h3 class="info-title">ğŸ’¡ Consejos prÃ¡cticos</h3>
            <div class="card">
                <div class="tip-item">ğŸ’³ El efectivo casi no se usa - configura Alipay/WeChat Pay</div>
                <div class="tip-item">ğŸ”’ Google/WhatsApp no funcionan sin VPN</div>
                <div class="tip-item">ğŸš• Los taxis usan DiDi, no paran en la calle</div>
                <div class="tip-item">ğŸ›’ Regatear es normal en mercados</div>
                <div class="tip-item">ğŸ’§ El agua del grifo NO es potable</div>
                <div class="tip-item">ğŸš‡ Metro cierra ~22:30-23:00</div>
            </div>
        </div>
    </div>

    <script>
        // ==================== DATA ====================
        const tripData = {
            startDate: new Date('2026-04-01T12:30:00'),
            
            cities: {
                beijing: {
                    name: 'Beijing',
                    emoji: 'ğŸ¯',
                    color: 'beijing',
                    days: [
                        {
                            day: 2, date: '2 Abril', weekday: 'Jueves',
                            title: 'Llegada + Jet Lag',
                            morning: 'Llegada 05:45, check-in temprano, descanso',
                            afternoon: 'Paseo ligero por el barrio',
                            evening: 'Wangfujing + Mercado escorpiones ğŸ¦‚',
                            notes: 'DÃ­a suave para adaptarse'
                        },
                        {
                            day: 3, date: '3 Abril', weekday: 'Viernes',
                            title: 'Ciudad Prohibida',
                            morning: 'Plaza Tiananmen + Ciudad Prohibida (4-5h)',
                            afternoon: 'Parque Jingshan (vistas panorÃ¡micas)',
                            evening: 'Parque Beihai + paseo en barco',
                            notes: 'â­ RESERVAR 7 dÃ­as antes',
                            queVerPlace: 'Ciudad Prohibida'
                        },
                        {
                            day: 4, date: '4 Abril', weekday: 'SÃ¡bado',
                            title: 'Gran Muralla',
                            morning: 'Salir 07:00 â†’ Gran Muralla Mutianyu',
                            afternoon: 'TelefÃ©rico subida + TobogÃ¡n bajada ğŸ›',
                            evening: 'Regreso Beijing + Cena Pato PekÃ­n ğŸ¦†',
                            notes: 'Coche privado ~700Â¥ ida/vuelta',
                            queVerPlace: 'Gran Muralla Mutianyu'
                        },
                        {
                            day: 5, date: '5 Abril', weekday: 'Domingo',
                            title: 'Templo del Cielo + Hutongs',
                            morning: 'Templo del Cielo (ver taichi locales)',
                            afternoon: 'Tour Hutongs en rickshaw + Shichahai',
                            evening: 'Lago Houhai - ambiente nocturno',
                            notes: 'Rickshaw ~150-200Â¥',
                            queVerPlace: 'Templo del Cielo'
                        },
                        {
                            day: 6, date: '6 Abril', weekday: 'Lunes',
                            title: 'Palacio de Verano',
                            morning: 'Palacio de Verano (3-4h)',
                            afternoon: 'Barco dragÃ³n en Lago Kunming ğŸ‰',
                            evening: 'Zhongguancun tech market ğŸ–¥ï¸ o descanso',
                            notes: 'Metro LÃ­nea 4',
                            queVerPlace: 'Palacio de Verano'
                        },
                        {
                            day: 7, date: '7 Abril', weekday: 'Martes',
                            title: 'Templo Lama + Villa OlÃ­mpica',
                            morning: 'Templo Lama + Templo Confucio',
                            afternoon: 'Torres Campana y Tambor',
                            evening: 'Villa OlÃ­mpica noche (Nido + Cubo) ğŸŸï¸',
                            notes: 'Luces se encienden ~19:40',
                            queVerPlace: 'Templo Lama + Villa OlÃ­mpica'
                        }
                    ]
                },
                xian: {
                    name: "Xi'an",
                    emoji: 'âš”ï¸',
                    color: 'xian',
                    days: [
                        {
                            day: 8, date: '8 Abril', weekday: 'MiÃ©rcoles',
                            title: 'Llegada Xi\'an',
                            morning: 'Check-out Beijing + EstaciÃ³n tren 08:00',
                            afternoon: 'Tren alta velocidad (4h30) â†’ Xi\'an ~14:00',
                            evening: 'Paseo centro + Barrio MusulmÃ¡n cena ğŸ¢',
                            notes: 'Primera noche en Xi\'an',
                            queVerPlace: 'Barrio MusulmÃ¡n'
                        },
                        {
                            day: 9, date: '9 Abril', weekday: 'Jueves',
                            title: 'Guerreros de Terracota',
                            morning: 'Salir 08:00 â†’ Guerreros Terracota',
                            afternoon: 'Taller DIY mini guerrero ğŸ¨ (niÃ±o)',
                            evening: 'Fuentes Gran Pagoda Ganso (show 20:30)',
                            notes: 'â­ RESERVAR online obligatorio',
                            queVerPlace: 'Guerreros de Terracota'
                        },
                        {
                            day: 10, date: '10 Abril', weekday: 'Viernes',
                            title: 'Muralla en bici',
                            morning: 'PequeÃ±a Pagoda Ganso + museo',
                            afternoon: 'Muralla de Xi\'an en bici al atardecer ğŸš²',
                            evening: 'Ãšltima cena Barrio MusulmÃ¡n',
                            notes: 'Bicis tandem disponibles',
                            queVerPlace: 'Muralla de Xi\'an + Pagodas'
                        }
                    ]
                },
                zhangjiajie: {
                    name: 'Zhangjiajie',
                    emoji: 'ğŸ”ï¸',
                    color: 'zhangjiajie',
                    days: [
                        {
                            day: 11, date: '11 Abril', weekday: 'SÃ¡bado',
                            title: 'Llegada Zhangjiajie',
                            morning: 'Check-out Xi\'an + aeropuerto',
                            afternoon: 'Vuelo Xi\'an â†’ Zhangjiajie (1h45)',
                            evening: 'Check-in Wulingyuan + paseo pueblo',
                            notes: 'Hotel cerca entrada parque'
                        },
                        {
                            day: 12, date: '12 Abril', weekday: 'Domingo',
                            title: 'Parque Nacional - Avatar',
                            morning: 'Entrada este Parque Nacional',
                            afternoon: 'Ascensor Bailong 326m ğŸ›— + Yuanjiajie',
                            evening: 'MontaÃ±a Tianzi (Avatar mountains)',
                            notes: 'â­ Entrada vÃ¡lida 4 dÃ­as',
                            queVerPlace: 'Parque Nacional Zhangjiajie (Avatar)'
                        },
                        {
                            day: 13, date: '13 Abril', weekday: 'Lunes',
                            title: 'Tianmen Mountain',
                            morning: 'Tianmen Mountain (telefÃ©rico 30min)',
                            afternoon: 'Pasarela cristal + Cueva del Cielo',
                            evening: 'Ten-Mile Gallery trenecito ğŸš‚',
                            notes: 'â­ RESERVAR Tianmen obligatorio',
                            queVerPlace: 'Tianmen Mountain'
                        }
                    ]
                },
                shanghai: {
                    name: 'Shanghai',
                    emoji: 'ğŸ¡',
                    color: 'shanghai',
                    days: [
                        {
                            day: 14, date: '14 Abril', weekday: 'Martes',
                            title: 'Llegada Shanghai',
                            morning: 'OpciÃ³n: Puente Cristal Gran CaÃ±Ã³n',
                            afternoon: 'Vuelo Zhangjiajie â†’ Shanghai (2h)',
                            evening: 'Check-in zona Disney + Disneytown paseo',
                            notes: 'Primera noche Shanghai'
                        },
                        {
                            day: 15, date: '15 Abril', weekday: 'MiÃ©rcoles',
                            title: 'DISNEYLAND DÃA 1 ğŸ°',
                            queVerPlace: 'Shanghai Disneyland',
                            morning: 'Apertura parque - TRON + Piratas',
                            afternoon: 'Zootopia + Seven Dwarfs',
                            evening: 'ILLUMINATE! fuegos artificiales ğŸ†',
                            notes: 'Llegar 1h antes apertura'
                        },
                        {
                            day: 16, date: '16 Abril', weekday: 'Jueves',
                            title: 'DISNEYLAND DÃA 2 ğŸ°',
                            queVerPlace: 'Shanghai Disneyland',
                            morning: 'Repetir favoritos',
                            afternoon: 'Atracciones pendientes + fotos',
                            evening: 'Cena temÃ¡tica + fuegos',
                            notes: 'DÃ­a mÃ¡s relajado'
                        },
                        {
                            day: 17, date: '17 Abril', weekday: 'Viernes',
                            title: 'Yu Garden + Bund',
                            morning: 'Yu Garden + Bazaar (xiaolongbao)',
                            afternoon: 'The Bund dÃ­a + TÃºnel psicodÃ©lico ğŸŒˆ',
                            evening: 'Crucero rÃ­o Huangpu noche ğŸš¢',
                            notes: 'Crucero ~120-180Â¥',
                            queVerPlace: 'Yu Garden + Bazaar'
                        },
                        {
                            day: 18, date: '18 Abril', weekday: 'SÃ¡bado',
                            title: 'Pudong futurista',
                            morning: 'Tren Maglev 430km/h ğŸš„',
                            afternoon: 'Torre Oriental Pearl (vistas)',
                            evening: 'Nanjing Road + compras',
                            notes: 'Maglev ~50Â¥ ida',
                            queVerPlace: 'Maglev + Torre Oriental Pearl'
                        },
                        {
                            day: 19, date: '19 Abril', weekday: 'Domingo',
                            title: 'Zhujiajiao Water Town',
                            morning: 'ExcursiÃ³n Zhujiajiao ğŸ˜ï¸',
                            afternoon: 'Paseo barca + pueblo antiguo',
                            evening: 'Ãšltima cena en The Bund',
                            notes: '~1h transporte cada trayecto',
                            queVerPlace: 'Zhujiajiao'
                        },
                        {
                            day: 20, date: '20 Abril', weekday: 'Lunes',
                            title: 'Ãšltimo dÃ­a + Aeropuerto',
                            morning: 'ConcesiÃ³n Francesa + Tianzifang',
                            afternoon: 'Compras + souvenirs',
                            evening: 'Cena despedida â†’ Aeropuerto 21:30',
                            notes: 'âš ï¸ Vuelo sale 00:40 del dÃ­a 21',
                            queVerPlace: 'ConcesiÃ³n Francesa + Tianzifang'
                        }
                    ]
                }
            },

            reservations: [
                { id: 'r0a', name: 'Vuelo Barcelona-PekÃ­n', city: 'Transporte', visitDate: '1 Abril', bookBefore: '-', price: '-', mandatory: true, reserved: true },
                { id: 'r0b', name: 'Vuelo Shanghai-Barcelona', city: 'Transporte', visitDate: '21 Abril', bookBefore: '-', price: '-', mandatory: true, reserved: true },
                { id: 'r0c', name: 'Hotel Beijing', city: 'Beijing', visitDate: '2-8 Abril', bookBefore: '-', price: '-', mandatory: true, reserved: true },
                { id: 'r1', name: 'Ciudad Prohibida', city: 'Beijing', visitDate: '3 Abril', bookBefore: '27 Marzo', price: '60Â¥ (GRATIS <18)', mandatory: true },
                { id: 'r2', name: 'Guerreros Terracota', city: "Xi'an", visitDate: '9 Abril', bookBefore: '2 Abril', price: '120Â¥ (GRATIS <14)', mandatory: true },
                { id: 'r3', name: 'Tianmen Mountain', city: 'Zhangjiajie', visitDate: '13 Abril', bookBefore: '11 Abril', price: '278Â¥ (GRATIS <14)', mandatory: true },
                { id: 'r4', name: 'Shanghai Disneyland (2 dÃ­as)', city: 'Shanghai', visitDate: '15-16 Abril', bookBefore: '10 Abril', price: '475Â¥/356Â¥ niÃ±o x dÃ­a', mandatory: true },
                { id: 'r5', name: 'Tren Beijing-Xi\'an', city: 'Transporte', visitDate: '8 Abril', bookBefore: '25 Marzo', price: '55-80â‚¬/persona', mandatory: true },
                { id: 'r6', name: 'Vuelo Xi\'an-Zhangjiajie', city: 'Transporte', visitDate: '11 Abril', bookBefore: '25 Marzo', price: '50-100â‚¬/persona', mandatory: true, reserved: true },
                { id: 'r7', name: 'Vuelo Zhangjiajie-Shanghai', city: 'Transporte', visitDate: '14 Abril', bookBefore: '25 Marzo', price: '60-120â‚¬/persona', mandatory: true, reserved: true },
                { id: 'r8', name: 'Parque Zhangjiajie', city: 'Zhangjiajie', visitDate: '12 Abril', bookBefore: '9 Abril', price: '225Â¥ 4 dÃ­as (GRATIS <14)', mandatory: false },
                { id: 'r9', name: 'Coche privado Muralla', city: 'Beijing', visitDate: '4 Abril', bookBefore: '2 Abril', price: '~700Â¥', mandatory: false }
            ],

            checklist: [
                {
                    category: 'ğŸ“„ DocumentaciÃ³n',
                    items: [
                        { id: 'doc1', text: 'Pasaportes vigentes (mÃ­n. 6 meses)' },
                        { id: 'doc2', text: 'Verificar exenciÃ³n visa 30 dÃ­as' },
                        { id: 'doc3', text: 'Copias digitales pasaportes (nube)' },
                        { id: 'doc4', text: 'Seguro viaje con cobertura mÃ©dica' },
                        { id: 'doc5', text: 'Avisar al banco de tarjetas' }
                    ]
                },
                {
                    category: 'ğŸ“± Apps necesarias',
                    items: [
                        { id: 'app1', text: 'WeChat (crear cuenta + pagos)' },
                        { id: 'app2', text: 'Alipay (vincular tarjeta)' },
                        { id: 'app3', text: 'Trip.com (reservas)' },
                        { id: 'app4', text: 'Google Translate (chino offline)' },
                        { id: 'app5', text: 'Maps.me (mapas offline)' },
                        { id: 'app6', text: 'VPN (ExpressVPN/NordVPN)' },
                        { id: 'app7', text: 'DiDi (taxis)' }
                    ]
                },
                {
                    category: 'ğŸ‘¶ Para el niÃ±o',
                    items: [
                        { id: 'kid1', text: 'Snacks familiares' },
                        { id: 'kid2', text: 'Medicamentos (Dalsy, termÃ³metro)' },
                        { id: 'kid3', text: 'Tablet + auriculares + pelis' },
                        { id: 'kid4', text: 'Libros y cuadernos' },
                        { id: 'kid5', text: 'Cochecito ligero o mochila porteo' },
                        { id: 'kid6', text: 'Ropa cÃ³moda + capas' }
                    ]
                },
                {
                    category: 'ğŸ§³ Equipaje',
                    items: [
                        { id: 'eq1', text: 'Maleta grande (facturar)' },
                        { id: 'eq2', text: 'Mochila/maleta cabina' },
                        { id: 'eq3', text: 'RiÃ±onera (documentos + mÃ³vil)' },
                        { id: 'eq4', text: 'Adaptador enchufe China' },
                        { id: 'eq5', text: 'Power bank cargada' },
                        { id: 'eq6', text: 'Candado maleta TSA' }
                    ]
                }
            ],

            // Sitios del Excel que no estÃ¡n en el itinerario principal (se pueden borrar)
            extraSites: [
                { id: 'ex1', city: 'Beijing', name: 'National Museum' },
                { id: 'ex2', city: 'Beijing', name: 'Qianmen Street' },
                { id: 'ex3', city: 'Beijing', name: 'Prince Gong\'s Mansion' },
                { id: 'ex4', city: 'Beijing', name: 'Old Summer Palace' },
                { id: 'ex5', city: 'Beijing', name: 'Tsinghua University' },
                { id: 'ex6', city: 'Beijing', name: 'Peking University' },
                { id: 'ex7', city: 'Beijing', name: 'Guozijian' },
                { id: 'ex8', city: 'Beijing', name: 'Military Museum' },
                { id: 'ex9', city: 'Beijing', name: 'Wukesong' },
                { id: 'ex10', city: 'Beijing', name: 'Beijing Universal Studios' },
                { id: 'ex11', city: "Xi'an", name: 'Bell Tower' },
                { id: 'ex12', city: "Xi'an", name: 'Shanxi History Museum' },
                { id: 'ex13', city: "Xi'an", name: 'SaJinQiao' },
                { id: 'ex14', city: "Xi'an", name: 'Grand Tang Mall' },
                { id: 'ex15', city: "Xi'an", name: 'HuaQing Palace' },
                { id: 'ex16', city: "Xi'an", name: 'Lishan Mountain' },
                { id: 'ex17', city: "Xi'an", name: 'The Song of Everlasting Sorrow' },
                { id: 'ex18', city: 'Zhangjiajie', name: 'Golden Whip Stream' },
                { id: 'ex19', city: 'Zhangjiajie', name: 'Ancient Town of Fenghuang' }
            ],

            // QuÃ© ver en cada sitio (resumen de lo mÃ¡s importante)
            queVer: [
                { place: 'Ciudad Prohibida', city: 'Beijing', emoji: 'ğŸ¯', points: ['Los Tres Salones: Suprema ArmonÃ­a, ArmonÃ­a Central, PreservaciÃ³n de la ArmonÃ­a.', 'Los Tres Palacios Traseros: residencia imperial y JardÃ­n Imperial.', 'Recorrido norte-sur desde la Puerta Wumen. Reservar 7 dÃ­as antes.'] },
                { place: 'Plaza Tiananmen + Jingshan', city: 'Beijing', emoji: 'ğŸ‡¨ğŸ‡³', points: ['Tiananmen: la plaza mÃ¡s grande del mundo. Foto con Mao.', 'Jingshan: colina artificial con las mejores vistas de la Ciudad Prohibida.'] },
                { place: 'Gran Muralla Mutianyu', city: 'Beijing', emoji: 'ğŸ›', points: ['Una de las secciones mejor conservadas. TelefÃ©rico subida, tobogÃ¡n bajada.', '23 torres de vigilancia. Llegar temprano. Coche privado ~700Â¥ ida/vuelta.'] },
                { place: 'Templo del Cielo', city: 'Beijing', emoji: 'â›©ï¸', points: ['SalÃ³n de OraciÃ³n por las Buenas Cosechas (edificio circular azul).', 'Muro del Eco y Altar Circular. Ver taichi y vida local por la maÃ±ana.'] },
                { place: 'Hutongs + Shichahai + Houhai', city: 'Beijing', emoji: 'ğŸš²', points: ['Tour en rickshaw por callejones tradicionales.', 'Shichahai y Lago Houhai: bares y ambiente nocturno.'] },
                { place: 'Palacio de Verano', city: 'Beijing', emoji: 'ğŸ‰', points: ['Lago Kunming: barco dragÃ³n y Puente de los 17 Arcos.', 'Gran Corredor (750 m con pinturas), Pagoda del Incienso, Barco de MÃ¡rmol. Metro L4.'] },
                { place: 'Templo Lama + Villa OlÃ­mpica', city: 'Beijing', emoji: 'ğŸŸï¸', points: ['Templo Lama: mayor templo tibetano en Beijing. Templo Confucio y Torres Campana/Tambor.', 'Nido y Cubo iluminados ~19:40.'] },
                { place: 'Guerreros de Terracota', city: "Xi'an", emoji: 'âš”ï¸', points: ['Fosa 1: la mÃ¡s espectacular, ~6000 guerreros en formaciÃ³n.', 'Fosas 2 y 3: arqueros, carros, generales. Museo de Carros de Bronce. Reserva online obligatoria.'] },
                { place: 'Muralla de Xi\'an + Pagodas', city: "Xi'an", emoji: 'ğŸš²', points: ['Muralla: una de las mejor conservadas. Recorrer en bici al atardecer.', 'Gran Pagoda Ganso: fuentes y show 20:30. PequeÃ±a Pagoda + museo.'] },
                { place: 'Barrio MusulmÃ¡n', city: "Xi'an", emoji: 'ğŸ¢', points: ['Calle de comida y artesanÃ­a. Cena de roujiamo, lamb skewers y pasteles.'] },
                { place: 'Parque Nacional Zhangjiajie (Avatar)', city: 'Zhangjiajie', emoji: 'ğŸ”ï¸', points: ['Yuanjiajie: pilares que inspiraron las montaÃ±as de Avatar. Ascensor Bailong 326 m.', 'MontaÃ±a Tianzi. Entrada vÃ¡lida 4 dÃ­as.'] },
                { place: 'Tianmen Mountain', city: 'Zhangjiajie', emoji: 'ğŸªŸ', points: ['TelefÃ©rico mÃ¡s largo del mundo. Pasarela de cristal y Cueva del Cielo.', 'Reservar entrada obligatorio.'] },
                { place: 'Ten-Mile Gallery', city: 'Zhangjiajie', emoji: 'ğŸš‚', points: ['Trencito panorÃ¡mico entre pilares. Relajado para cerrar el dÃ­a.'] },
                { place: 'Shanghai Disneyland', city: 'Shanghai', emoji: 'ğŸ°', points: ['TRON, Piratas, Zootopia, Seven Dwarfs. Show ILLUMINATE! por la noche.', 'Llegar 1 h antes de apertura.'] },
                { place: 'Yu Garden + Bazaar', city: 'Shanghai', emoji: 'ğŸŒ¿', points: ['JardÃ­n clÃ¡sico Ming: rocallas, estanques, pabellones. Xiaolongbao en el bazar.'] },
                { place: 'The Bund + Crucero Huangpu', city: 'Shanghai', emoji: 'ğŸŒƒ', points: ['Paseo 1,5 km con fachadas coloniales. Contraste con Pudong. Crucero noche ~120-180Â¥.'] },
                { place: 'Maglev + Torre Oriental Pearl', city: 'Shanghai', emoji: 'ğŸš„', points: ['Tren Maglev 430 km/h hasta aeropuerto Pudong. Torre con vistas.'] },
                { place: 'Zhujiajiao', city: 'Shanghai', emoji: 'ğŸ˜ï¸', points: ['Pueblo acuÃ¡tico: Puente Fangsheng, paseo en barca, North Street. ~1 h desde Shanghai.'] },
                { place: 'ConcesiÃ³n Francesa + Tianzifang', city: 'Shanghai', emoji: 'â˜•', points: ['Calles con Ã¡rboles, galerÃ­as y cafÃ©s. Tianzifang: callejones con tiendas y arte.'] }
            ]
        };

        // ==================== FUNCTIONS ====================
        
        // Show page
        function showPage(pageName, element) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            // Show selected page
            document.getElementById('page-' + pageName).classList.add('active');
            // Update tabs
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            if (element) {
                element.classList.add('active');
            } else {
                // Fallback: find button by onclick attribute
                const btn = document.querySelector(`.tab-btn[onclick*="showPage('${pageName}')"]`);
                if (btn) btn.classList.add('active');
            }
            // Save state
            localStorage.setItem('chinaTrip_currentPage', pageName);
        }

        // Hora Madrid / China y diferencia horaria (visible en todas las pestaÃ±as)
        function updateTimezoneDisplay() {
            const opts = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
            try {
                const madrid = new Date().toLocaleTimeString('es-ES', { ...opts, timeZone: 'Europe/Madrid' });
                const china = new Date().toLocaleTimeString('es-ES', { ...opts, timeZone: 'Asia/Shanghai' });
                document.getElementById('tz-madrid').textContent = madrid;
                document.getElementById('tz-china').textContent = china;
                const now = new Date();
                const madridHour = parseInt(now.toLocaleString('en-US', { timeZone: 'Europe/Madrid', hour: 'numeric', hour12: false }), 10);
                const chinaHour = parseInt(now.toLocaleString('en-US', { timeZone: 'Asia/Shanghai', hour: 'numeric', hour12: false }), 10);
                let diff = chinaHour - madridHour;
                if (diff > 12) diff -= 24;
                if (diff < -12) diff += 24;
                const diffStr = diff >= 0 ? '+' + diff + 'h' : diff + 'h';
                document.getElementById('tz-diff').textContent = 'China ' + diffStr + ' vs Madrid';
            } catch (e) {
                document.getElementById('tz-madrid').textContent = '--';
                document.getElementById('tz-china').textContent = '--';
                document.getElementById('tz-diff').textContent = 'China +6h/+7h vs Madrid';
            }
        }

        // Countdown
        function updateCountdown() {
            const now = new Date();
            const diff = tripData.startDate - now;
            
            if (diff <= 0) {
                document.getElementById('countdown-time').textContent = 'Â¡Ya!';
                document.getElementById('countdown-label').textContent = 'El viaje ha comenzado';
                return;
            }
            
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            
            if (days > 0) {
                document.getElementById('countdown-time').textContent = days;
                document.getElementById('countdown-label').textContent = days === 1 ? 'dÃ­a' : 'dÃ­as';
            } else {
                document.getElementById('countdown-time').textContent = hours;
                document.getElementById('countdown-label').textContent = hours === 1 ? 'hora' : 'horas';
            }
        }

        // Show city detail
        function showCity(cityId) {
            const city = tripData.cities[cityId];
            if (!city) return;
            
            // Switch to ciudades page
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-ciudades').classList.add('active');
            
            // Hide cities list, show detail
            document.getElementById('cities-list').style.display = 'none';
            document.getElementById('city-detail').style.display = 'block';
            
            // Generate content
            let html = `
                <div class="card city-card ${city.color}">
                    <div class="city-header">
                        <span class="city-emoji">${city.emoji}</span>
                        <div class="city-info">
                            <h3>${city.name}</h3>
                            <p>${city.days.length} dÃ­as de itinerario</p>
                        </div>
                    </div>
                </div>
            `;
            
            city.days.forEach((day, index) => {
                const isOpen = index === 0 ? 'open' : '';
                const qv = day.queVerPlace && tripData.queVer ? tripData.queVer.find(q => q.place === day.queVerPlace) : null;
                const queVerHtml = qv ? `
                    <div class="day-section day-que-ver">
                        <div class="day-section-title">ğŸ“Œ QuÃ© ver aquÃ­</div>
                        <ul class="que-ver-points">
                            ${(qv.points || []).map(p => `<li>${addEurToYuanPrice(p)}</li>`).join('')}
                        </ul>
                    </div>
                ` : '';
                html += `
                    <div class="card day-card">
                        <div class="day-header" onclick="toggleDay(this)">
                            <div class="day-title">
                                <div class="day-number">${day.day}</div>
                                <div>
                                    <div class="font-bold">${day.title}</div>
                                    <div class="text-sm text-gray">${day.date} â€¢ ${day.weekday}</div>
                                </div>
                            </div>
                            <span>â–¼</span>
                        </div>
                        <div class="day-content ${isOpen}">
                            <div class="day-section">
                                <div class="day-section-title">ğŸŒ… MaÃ±ana</div>
                                <div class="day-section-text">${day.morning}</div>
                            </div>
                            <div class="day-section">
                                <div class="day-section-title">â˜€ï¸ Tarde</div>
                                <div class="day-section-text">${day.afternoon}</div>
                            </div>
                            <div class="day-section">
                                <div class="day-section-title">ğŸŒ™ Noche</div>
                                <div class="day-section-text">${day.evening}</div>
                            </div>
                            ${day.notes ? `<div class="day-section"><div class="day-section-title">ğŸ“ Notas</div><div class="day-section-text text-gold">${addEurToYuanPrice(day.notes)}</div></div>` : ''}
                            ${queVerHtml}
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('city-detail-content').innerHTML = html;
        }

        function hideCityDetail() {
            document.getElementById('cities-list').style.display = 'block';
            document.getElementById('city-detail').style.display = 'none';
        }

        function toggleDay(element) {
            const content = element.nextElementSibling;
            content.classList.toggle('open');
        }

        // Reservations
        function renderReservations() {
            let saved = JSON.parse(localStorage.getItem('chinaTrip_reservations') || '{}');
            // Pre-marcar como confirmadas las reservas ya hechas (reserved: true)
            tripData.reservations.forEach(r => {
                if (r.reserved) saved[r.id] = true;
            });
            localStorage.setItem('chinaTrip_reservations', JSON.stringify(saved));
            const mandatory = tripData.reservations.filter(r => r.mandatory);
            const other = tripData.reservations.filter(r => !r.mandatory);
            
            let html1 = '';
            mandatory.forEach(r => {
                const checked = (saved[r.id] || r.reserved) ? 'checked' : '';
                html1 += createReservationCard(r, checked, true);
            });
            document.getElementById('reservas-obligatorias').innerHTML = html1;
            
            let html2 = '';
            other.forEach(r => {
                const checked = (saved[r.id] || r.reserved) ? 'checked' : '';
                html2 += createReservationCard(r, checked, false);
            });
            document.getElementById('reservas-otras').innerHTML = html2;
            
            updateReservationsProgress();
        }

        function createReservationCard(r, checked, mandatory) {
            const showDates = r.bookBefore && r.bookBefore !== '-';
            const showPrice = r.price && r.price !== '-';
            return `
                <div class="card reservation-card ${mandatory ? 'mandatory' : ''}" onclick="toggleReservation('${r.id}')">
                    <div class="checklist-item ${checked}">
                        <div class="checkbox">
                            <span class="checkbox-icon">âœ“</span>
                        </div>
                        <div style="flex:1">
                            <div class="font-bold">${r.name}${r.reserved ? ' <span class="text-green">âœ… Reservado</span>' : ''}</div>
                            <div class="text-sm text-gray">${r.city}</div>
                        </div>
                    </div>
                    <div class="reservation-dates">
                        <div class="reservation-date">
                            <div class="reservation-date-label">ğŸ“… Visita</div>
                            <div class="reservation-date-value">${r.visitDate}</div>
                        </div>
                        ${r.flightTime ? `<div class="reservation-date">
                            <div class="reservation-date-label">ğŸ• Hora</div>
                            <div class="reservation-date-value">${r.flightTime}${r.flightNumber ? ' â€¢ ' + r.flightNumber : ''}</div>
                        </div>` : ''}
                        ${showDates ? `<div class="reservation-date">
                            <div class="reservation-date-label">â° Reservar antes</div>
                            <div class="reservation-date-value text-red">${r.bookBefore}</div>
                        </div>` : ''}
                    </div>
                    ${showPrice ? `<div class="text-sm text-gold">ğŸ’° ${addEurToYuanPrice(r.price)}</div>` : ''}
                </div>
            `;
        }

        function toggleReservation(id) {
            const saved = JSON.parse(localStorage.getItem('chinaTrip_reservations') || '{}');
            saved[id] = !saved[id];
            localStorage.setItem('chinaTrip_reservations', JSON.stringify(saved));
            renderReservations();
        }

        function updateReservationsProgress() {
            const saved = JSON.parse(localStorage.getItem('chinaTrip_reservations') || '{}');
            const total = tripData.reservations.length;
            const done = Object.values(saved).filter(v => v).length;
            const percent = Math.round((done / total) * 100);
            
            document.getElementById('reservas-progress-text').textContent = `${done}/${total}`;
            document.getElementById('reservas-progress-bar').style.width = `${percent}%`;
        }

        // Checklist
        function renderChecklist() {
            const saved = JSON.parse(localStorage.getItem('chinaTrip_checklist') || '{}');
            let html = '';
            
            tripData.checklist.forEach((cat, catIndex) => {
                const catDone = cat.items.filter(item => saved[item.id]).length;
                const isOpen = catIndex === 0 ? 'open' : '';
                
                html += `
                    <div class="category">
                        <div class="category-header" onclick="toggleCategory(this)">
                            <span class="category-title">${cat.category}</span>
                            <span class="category-progress">${catDone}/${cat.items.length}</span>
                        </div>
                        <div class="category-content ${isOpen}">
                `;
                
                cat.items.forEach(item => {
                    const checked = saved[item.id] ? 'checked' : '';
                    html += `
                        <div class="checklist-item ${checked}" onclick="toggleCheckItem('${item.id}')">
                            <div class="checkbox">
                                <span class="checkbox-icon">âœ“</span>
                            </div>
                            <span class="checklist-text">${item.text}</span>
                        </div>
                    `;
                });
                
                html += `</div></div>`;
            });
            
            document.getElementById('checklist-container').innerHTML = html;
            updateChecklistProgress();
        }

        function toggleCategory(element) {
            const content = element.nextElementSibling;
            content.classList.toggle('open');
        }

        function toggleCheckItem(id) {
            event.stopPropagation();
            const saved = JSON.parse(localStorage.getItem('chinaTrip_checklist') || '{}');
            saved[id] = !saved[id];
            localStorage.setItem('chinaTrip_checklist', JSON.stringify(saved));
            renderChecklist();
        }

        function updateChecklistProgress() {
            const saved = JSON.parse(localStorage.getItem('chinaTrip_checklist') || '{}');
            let total = 0;
            let done = 0;
            
            tripData.checklist.forEach(cat => {
                cat.items.forEach(item => {
                    total++;
                    if (saved[item.id]) done++;
                });
            });
            
            const percent = Math.round((done / total) * 100);
            document.getElementById('check-progress-text').textContent = `${done}/${total}`;
            document.getElementById('check-progress-bar').style.width = `${percent}%`;
        }

        // Currency converter â‚¬ â†’ Â¥ (tipo de cambio aprox. enero 2025)
        const EUR_TO_CNY = 8.27;
        // AÃ±ade el equivalente en â‚¬ al lado de cada precio en Â¥ (para mostrar en reservas, quÃ© ver, notas)
        function addEurToYuanPrice(str) {
            if (!str || typeof str !== 'string' || !str.includes('Â¥')) return str;
            const rate = EUR_TO_CNY;
            return str.replace(/(~?)(\d+(?:\.\d+)?)(?:\s*-\s*(\d+(?:\.\d+)?))?\s*Â¥/g, (_, tilde, n1, n2) => {
                const e1 = (parseFloat(n1) / rate).toFixed(2);
                if (n2) {
                    const e2 = (parseFloat(n2) / rate).toFixed(2);
                    return (tilde || '') + n1 + '-' + n2 + 'Â¥ (â‰ˆ' + e1 + '-' + e2 + 'â‚¬)';
                }
                return (tilde || '') + n1 + 'Â¥ (â‰ˆ' + e1 + 'â‚¬)';
            });
        }
        function convertCurrency() {
            const eur = parseFloat(document.getElementById('eur-input').value) || 0;
            const cny = (eur * EUR_TO_CNY).toFixed(2);
            document.getElementById('cny-result').textContent = cny;
        }

        // Currency converter Â¥ â†’ â‚¬
        function convertCurrencyCnyToEur() {
            const cny = parseFloat(document.getElementById('cny-input').value) || 0;
            const eur = (cny / EUR_TO_CNY).toFixed(2);
            document.getElementById('eur-result').textContent = eur;
        }

        // QuÃ© ver - resumen por sitio
        function renderQueVer() {
            const container = document.getElementById('que-ver-container');
            if (!container || !tripData.queVer) return;
            container.innerHTML = tripData.queVer.map(q => `
                <div class="que-ver-card">
                    <div class="que-ver-header">
                        <span class="que-ver-emoji">${q.emoji}</span>
                        <div>
                            <div class="que-ver-title">${q.place}</div>
                            <div class="que-ver-city">${q.city}</div>
                        </div>
                    </div>
                    <ul class="que-ver-points">
                        ${(q.points || []).map(p => `<li>${p}</li>`).join('')}
                    </ul>
                </div>
            `).join('');
        }

        // Extra sites (del Excel) - se pueden borrar
        function renderExtraSites() {
            const deleted = JSON.parse(localStorage.getItem('chinaTrip_deletedExtraSites') || '[]');
            const visible = tripData.extraSites.filter(s => !deleted.includes(s.id));
            const container = document.getElementById('extra-sites-container');
            if (!container) return;
            if (visible.length === 0) {
                container.innerHTML = '<p class="text-sm text-gray">No hay sitios extra o los has borrado todos.</p>';
                return;
            }
            container.innerHTML = visible.map(s => `
                <div class="extra-site-item" data-id="${s.id}">
                    <div class="extra-site-info">
                        <div>${s.name}</div>
                        <div class="extra-site-city">${s.city}</div>
                    </div>
                    <button type="button" class="extra-site-delete" onclick="removeExtraSite('${s.id}')">Borrar</button>
                </div>
            `).join('');
        }

        function removeExtraSite(id) {
            const deleted = JSON.parse(localStorage.getItem('chinaTrip_deletedExtraSites') || '[]');
            if (!deleted.includes(id)) {
                deleted.push(id);
                localStorage.setItem('chinaTrip_deletedExtraSites', JSON.stringify(deleted));
                renderExtraSites();
            }
        }

        // ==================== INIT ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Update countdown
            updateCountdown();
            setInterval(updateCountdown, 60000);
            // Hora Madrid / China (visible en todas las pestaÃ±as)
            updateTimezoneDisplay();
            setInterval(updateTimezoneDisplay, 1000);
            
            // Render components
            renderReservations();
            renderChecklist();
            renderExtraSites();
            renderQueVer();
            
            // Restore last page
            const lastPage = localStorage.getItem('chinaTrip_currentPage');
            if (lastPage) {
                const btn = document.querySelector(`.tab-btn[onclick*="showPage('${lastPage}'"]`);
                if (btn) {
                    showPage(lastPage, btn);
                }
            }
            
            // ==================== SCROLL HIDE/SHOW ====================
            let lastScrollTop = 0;
            const tabBar = document.querySelector('.tab-bar');
            const header = document.querySelector('.header');
            
            function handleScroll() {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                
                // Si scrolleamos hacia abajo o estamos arriba, mostrar elementos
                if (scrollTop < lastScrollTop || scrollTop < 10) {
                    if (tabBar) tabBar.classList.remove('hidden');
                    if (header) header.classList.remove('hidden');
                } 
                // Si scrolleamos hacia arriba, ocultar elementos
                else if (scrollTop > lastScrollTop && scrollTop > 50) {
                    if (tabBar) tabBar.classList.add('hidden');
                    if (header) header.classList.add('hidden');
                }
                
                lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
            }
            
            // Setup scroll listener
            window.addEventListener('scroll', handleScroll, { passive: true });
        });

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(() => console.log('SW registered'))
                .catch(err => console.log('SW error:', err));
        }
    </script>
</body>
</html>
